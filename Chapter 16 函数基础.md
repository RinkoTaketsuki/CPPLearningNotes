# Chapter 16 函数基础

> 函数包含返回类型、函数名、形参列表、函数体  
> 调用运算符() 用来执行函数

## 1. 函数的执行过程

1. 用实参初始化形参
2. 主调函数执行被中断，执行被调函数
3. 如遇到return语句，则结束当前函数并返回对应值，并切换回主调函数

## 2. 实参、形参、返回类型的注意事项

1. 实参数量必须等于形参数量，形参必会被初始化，实参类型必须能转化成形参类型
2. 多个形参的初始化的执行顺序未知（逗号运算符的执行顺序）
3. 形参列表与初始化列表不同，不能写成 `void f(int v1, v2)` 这种形式
4. 形参列表可以为空，用空的括号或者括号里写void表示
5. 不可有同名形参，形参可以不命名表示不使用该形参
6. 返回类型不能是数组和函数类型，但可以是指向数组的指针或引用，也可以是函数指针

## 3. 局部变量

> 形参和函数体内部定义的变量均为局部变量

### 自动对象

> 生命周期从定义语句到块末尾的局部变量

1. 函数终止时自动对象被销毁
2. 形参均属于自动对象
3. 未显式初始化的自动对象将不被初始化

### 局部静态对象

> 生命周期从定义语句到整个程序结束的局部变量

1. 函数终止时不会被销毁
2. 未被显式初始化时则初始化为0

## 4. 函数声明（函数原型）

> 相比函数定义，不包含函数体，无须形参名，用分号结尾  
> 可以添加默认实参

## 5. 内联函数

1. 用关键字inline表示，代表希望编译器编译时在调用点把函数展开
2. 编译器不一定处理inline请求，且一般不支持inline递归
3. 可多次定义但每个定义必须完全一致
4. 尽量在头文件中定义

## 6. constexpr函数

1. 函数的返回类型是constexpr，所有形参必须是字面值类型（能声明constexpr的类型），函数体中只能有一条return语句  
2. 该类函数通常在编译时就会展开计算返回值（内联函数），函数体中不能有运行时才能确定结果的语句  
3. 如果输入值并非是constexpr，则返回的值也不是constexpr
4. 可多次定义但每个定义必须完全一致
5. 尽量在头文件中定义

## 7. 函数指针

> 函数类型 = 返回类型 + 形参类型

```C++
ret_t (*pf)(para_t1, para_t2, ...);
// 包住变量名的括号不可省，否则便是返回类型为ret_t*类型的函数
```

把函数名作为右值使用时，其会自动转化为函数指针，加不加取地址符均可  
函数指针可直接用于调用函数，加不加解引用符均可

```C++
int f(int);
int (*pf)(int);
int v;
// 等价的赋值语句
pf = f; pf = &f;
// 等价的赋值语句
v = f(0); v = pf(0); v = (*pf)(0);
// 等价的函数声明
void foo(int pf(int)); void foo(int (*pf)(int));
void foo(decltype(f)); void foo(decltype(f)*);
// 注意decltype(函数)返回的是函数类型而非函数指针类型
```

有重载函数时，由于函数指针带有形参列表，故可以区分  
需要注意的是，返回函数指针必须显式声明为指针，不能返回函数类型

```C++
using fun_t = bool(double);
using pfun_t = bool(*)(double);
fun_t foo(int); // 错误
pfun_t foo(int); // 正确
fun_t *foo(int); // 正确
bool (*foo(int))(double); // 正确，直接写法
auto foo(int) -> bool(*)(double); // 正确，尾置返回类型
```

auto初始化作类型判断时，由于函数作为右值使用会转换为函数指针，故会判断为函数指针
